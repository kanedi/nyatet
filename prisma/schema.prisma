generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum OrganizationType {
  RT
  UMKM
  SYSTEM
}

enum Role {
  ADMIN
  USER
  SUPER_ADMIN
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum BillStatus {
  UNPAID
  PAID
  CANCELLED
}

model Organization {
  id        String           @id @default(cuid())
  name      String
  type      OrganizationType
  createdAt DateTime         @default(now())
  users     User[]
  members   Member[]
  products  Product[]
  bills     Bill[]
  transactions Transaction[]
}

model User {
  id             String       @id @default(cuid())
  organizationId String
  email          String       @unique
  password       String
  role           Role         @default(USER)
  organization   Organization @relation(fields: [organizationId], references: [id])
}

model Member {
  id             String       @id @default(cuid())
  organizationId String
  name           String
  phone          String?
  address        String?
  notes          String?      // e.g. Vehicle Plate Number
  organization   Organization @relation(fields: [organizationId], references: [id])
  transactions   Transaction[]
  bills          Bill[]
}

model Product {
  id             String       @id @default(cuid())
  organizationId String
  name           String
  price          Float
  costPrice      Float        @default(0)
  unit           String?      // e.g., 'kg', 'pcs', 'bulan'
  isService      Boolean      @default(false)
  stock          Int          @default(0)
  organization   Organization @relation(fields: [organizationId], references: [id])
  transactionItems TransactionItem[]
}

model Transaction {
  id             String            @id @default(cuid())
  organizationId String
  memberId       String?
  type           TransactionType
  totalAmount    Float
  date           DateTime          @default(now())
  organization   Organization      @relation(fields: [organizationId], references: [id])
  member         Member?           @relation(fields: [memberId], references: [id])
  items          TransactionItem[]
}

model TransactionItem {
  id            String      @id @default(cuid())
  transactionId String
  productId     String
  quantity      Int
  priceAtSale   Float
  costAtSale    Float       @default(0)
  transaction   Transaction @relation(fields: [transactionId], references: [id])
  product       Product     @relation(fields: [productId], references: [id])
}

model Bill {
  id             String       @id @default(cuid())
  organizationId String
  memberId       String
  period         String       // e.g., "Januari 2024"
  amount         Float
  status         BillStatus   @default(UNPAID)
  organization   Organization @relation(fields: [organizationId], references: [id])
  member         Member       @relation(fields: [memberId], references: [id])
}
